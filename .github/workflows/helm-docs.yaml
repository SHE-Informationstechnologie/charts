name: Check that docs are generated

on: push

jobs:
  docs:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
      - uses: gabe565/setup-helm-docs-action@v1
      - run: helm-docs --chart-search-root=charts --template-files=./README.md.gotmpl
      - name: Verify Changed files
        uses: tj-actions/verify-changed-files@v17
        id: verify-changed-files
        with:
          files: |
             charts/*/README.md
      - name: Show information of changed files
        if: steps.verify-changed-files.outputs.files_changed == 'true'
        env:
          CHANGED_FILES: ${{ steps.verify-changed-files.outputs.changed_files }}
        run: |
          for file in ${CHANGED_FILES}
          do
            echo "::error file=${file}::File ${file} has been changed"
          done
          exit 1
